<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø¤Ø³Ø³Ø© Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ø®ÙŠØ±ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&family=Cairo:wght@700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        :root {
            /* Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ø®ÙŠØ±ÙŠØ© Ù‡Ø§Ø¯Ø¦Ø© (Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ù…Ø±ÙŠØ­ ÙˆØ§Ù„Ø¨ÙŠØ¬ Ø§Ù„Ø¯Ø§ÙØ¦) */
            --primary: #2D5A27;
            --secondary: #5B8E7D;
            --accent: #F4F1EA;
            --success: #689F38;
            --danger: #BC4749;
            --text: #2C3531;
            --text-light: #6D7275;
            --bg: #FCFBF7;
            --card: #FFFFFF;
            --shadow: 0 4px 12px rgba(45, 90, 39, 0.08);
        }
        [data-theme="dark"] {
            --primary: #8EB69B;
            --accent: #2D3A30;
            --text: #F1F7ED;
            --text-light: #B2C2B9;
            --bg: #1B241D;
            --card: #252F27;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        * {margin:0;padding:0;box-sizing:border-box}
        body {
            font-family:'Tajawal',sans-serif;
            background:var(--bg);
            color:var(--text);
            line-height:1.6;
        }
        .header {
            background: linear-gradient(135deg, #2D5A27, #467141);
            padding:15px;
            text-align:center;
            position:sticky;
            top:0;
            z-index:100;
            box-shadow:var(--shadow);
            border-bottom:2px solid rgba(255,255,255,0.05);
        }
        .header-content {
            max-width:1200px;
            margin:0 auto;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:10px;
            flex-wrap:wrap;
        }
        .logo-section {
            display:flex;
            align-items:center;
            gap:12px;
        }
        .logo {
            width:45px;
            height:45px;
            background:white;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:24px;
            flex-shrink:0;
            cursor:pointer;
            box-shadow:0 2px 8px rgba(0,0,0,0.1);
        }
        .header h1 {
            color:white;
            font-size:16px;
            font-weight:900;
            font-family:'Cairo',sans-serif;
        }
        .header p {
            color: #E8F5E9;
            font-size:11px;
            opacity: 0.9;
        }
        .icon-btn {
            width:40px;
            height:40px;
            border-radius:50%;
            background:rgba(255,255,255,0.15);
            border:none;
            color:white;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            transition: 0.3s;
        }
        .icon-btn:hover {
            background:rgba(255,255,255,0.25);
        }
        .container {
            max-width:1200px;
            margin:0 auto;
            padding:15px;
        }
        .sync-indicator {
            position:fixed;
            bottom:20px;
            left:20px;
            background:var(--success);
            color:white;
            padding:8px 12px;
            border-radius:20px;
            font-size:11px;
            z-index:1000;
            display:none;
            align-items:center;
            gap:6px;
            box-shadow:var(--shadow);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .sync-indicator.show {
            display:flex;
            opacity: 1;
            visibility: visible;
        }
        .case-card {
            background:var(--card);
            border-radius:12px;
            overflow:hidden;
            box-shadow:var(--shadow);
            margin-bottom:15px;
            border:1px solid rgba(45, 90, 39, 0.05);
            transition: transform 0.3s;
        }
        .case-card:hover {
            transform: translateY(-3px);
        }
        .case-images {
            position:relative;
            height:220px;
            background:#E0E5DF;
            overflow:hidden;
        }
        .case-image {
            width:100%;
            height:100%;
            object-fit:cover;
            display:none;
        }
        .case-image.active {display:block}
        .image-nav {
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            background:rgba(0,0,0,0.5);
            color:white;
            border:none;
            width:32px;
            height:32px;
            border-radius:50%;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .image-nav.prev {left:8px}
        .image-nav.next {right:8px}
        .indicators {
            position:absolute;
            bottom:8px;
            left:50%;
            transform:translateX(-50%);
            display:flex;
            gap:5px;
        }
        .indicator {
            width:6px;
            height:6px;
            border-radius:50%;
            background:rgba(255,255,255,0.5);
            cursor:pointer;
        }
        .indicator.active {
            background:white;
            width:20px;
            border-radius:3px;
        }
        .case-content {padding:15px}
        .case-status {
            display:inline-block;
            font-size:11px;
            font-weight:600;
        }
        .case-status.active {color:#5B8E7D}
        .case-status.urgent {color:#BC4749}
        .case-status.completed {color:#2D5A27}
        .case-title {
            font-size:17px;
            font-weight:700;
            margin:10px 0;
            font-family:'Cairo',sans-serif;
        }
        .case-description {
            font-size:13px;
            color:var(--text-light);
            margin-bottom:15px;
            max-height:50px;
            overflow:hidden;
        }
        .progress-info {
            display:flex;
            justify-content:space-between;
            margin-bottom:8px;
            font-size:12px;
            flex-wrap:wrap;
        }
        .collected {color:var(--success);font-weight:700}
        .remaining {color:var(--danger);font-weight:700}
        .progress-bar-container {
            height:8px;
            background:#EDF1EE;
            border-radius:6px;
            overflow:hidden;
            margin-bottom:6px;
        }
        .progress-bar {
            height:100%;
            background:linear-gradient(90deg, #2D5A27, #689F38);
            border-radius:6px;
            position:relative;
        }
        .btn {
            width:100%;
            padding:12px;
            border:none;
            border-radius:10px;
            font-family:'Tajawal',sans-serif;
            font-weight:700;
            cursor:pointer;
            font-size:13px;
            display:flex;
            align-items:center;
            justify-content:center;
            gap:6px;
            transition: 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #2D5A27, #5B8E7D);
            color:white;
        }
        .btn-primary:hover {
            filter: brightness(1.1);
            box-shadow: 0 4px 12px rgba(45, 90, 39, 0.2);
        }
        .btn-danger {
            background:var(--danger);
            color:white;
        }
        .btn-small {padding:8px 12px;font-size:11px;width:auto}
        .modal {
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.9);
            z-index:1000;
            padding:10px;
        }
        .modal.active {
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .modal-content {
            background:var(--card);
            border-radius:16px;
            padding:20px;
            max-width:500px;
            width:100%;
            max-height:90vh;
            overflow-y:auto;
            position:relative;
        }
        .modal-close {
            position:absolute;
            top:12px;
            left:12px;
            background:var(--danger);
            color:white;
            border:none;
            width:32px;
            height:32px;
            border-radius:50%;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:18px;
        }
        .modal-title {
            font-size:18px;
            font-weight:700;
            margin-bottom:15px;
            color:var(--primary);
            font-family:'Cairo',sans-serif;
        }
        .form-group {margin-bottom:15px}
        .form-label {
            display:block;
            margin-bottom:6px;
            font-weight:600;
            font-size:13px;
        }
        .form-input,.form-textarea {
            width:100%;
            padding:10px;
            border:2px solid var(--accent);
            border-radius:10px;
            font-family:'Tajawal',sans-serif;
            font-size:13px;
            background:var(--bg);
            color:var(--text);
        }
        .form-input:focus,.form-textarea:focus {
            outline:none;
            border-color:var(--primary);
        }
        .form-textarea {
            resize:vertical;
            min-height:80px;
        }
        .file-upload {
            border:2px dashed var(--accent);
            border-radius:10px;
            padding:20px;
            text-align:center;
            cursor:pointer;
            background:var(--bg);
        }
        .file-input {display:none}
        .preview-images {
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
            gap:8px;
            margin-top:12px;
        }
        .preview-image {
            position:relative;
            aspect-ratio:1;
            border-radius:8px;
            overflow:hidden;
        }
        .preview-image img {
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .preview-remove {
            position:absolute;
            top:4px;
            right:4px;
            background:var(--danger);
            color:white;
            border:none;
            width:22px;
            height:22px;
            border-radius:50%;
            cursor:pointer;
            font-size:13px;
        }
        .admin-panel {
            display:none;
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.9);
            z-index:1500;
            overflow-y:auto;
        }
        .admin-panel.active {display:block}
        .admin-content {
            background:var(--card);
            max-width:900px;
            margin:20px auto;
            border-radius:16px;
            padding:20px;
        }
        .admin-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:20px;
            padding-bottom:15px;
            border-bottom:2px solid var(--accent);
        }
        .admin-tabs {
            display:flex;
            gap:8px;
            margin-bottom:20px;
            flex-wrap:wrap;
        }
        .admin-tab {
            padding:10px 18px;
            background:var(--accent);
            border:none;
            border-radius:10px;
            font-family:'Tajawal',sans-serif;
            font-weight:600;
            cursor:pointer;
            font-size:13px;
        }
        .admin-tab.active {
            background:linear-gradient(135deg,var(--primary),var(--secondary));
            color:white;
        }
        .tab-content {display:none}
        .tab-content.active {display:block}
        .bank-account {
            background:var(--bg);
            padding:15px;
            border-radius:10px;
            margin-bottom:12px;
        }
        .bank-info-item {
            display:flex;
            justify-content:space-between;
            padding:6px 0;
            border-bottom:1px solid var(--accent);
            font-size:13px;
            flex-wrap:wrap;
        }
        .bank-info-label {font-weight:600;color:var(--text-light)}
        .bank-info-value {
            font-weight:700;
            color:var(--primary);
            word-break:break-all;
        }
        .notification {
            position:fixed;
            top:80px;
            right:15px;
            background:var(--success);
            color:white;
            padding:12px 18px;
            border-radius:10px;
            z-index:3000;
            transform:translateX(400px);
            transition:transform 0.3s;
            font-size:13px;
            max-width:calc(100% - 30px);
        }
        .notification.show {transform:translateX(0)}
        .notification.error {background:var(--danger)}
        .initiative-header {
            display:flex;
            align-items:center;
            gap:15px;
            padding:20px;
            background:var(--primary);
            margin-bottom:15px;
            border-radius:16px 16px 0 0;
            box-shadow: inset 0 -10px 20px rgba(0,0,0,0.05);
        }
        .initiative-title {
            color:white;
            font-family:'Cairo',sans-serif;
            font-size:20px;
            font-weight:900;
            margin-bottom:5px;
        }
        .initiative-desc {
            color:rgba(255,255,255,0.95);
            font-size:13px;
        }
        @media (max-width:768px) {
            .header {padding:12px}
            .header h1 {font-size:15px}
            .logo {width:40px;height:40px;font-size:20px}
            .container {padding:12px}
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">ğŸ’§</div>
                <div class="header-text">
                    <h1>Ù…Ø¤Ø³Ø³Ø© Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ø®ÙŠØ±ÙŠØ©</h1>
                    <p>ÙƒÙ„ Ù‚Ø·Ø±Ø© ØªØµÙ†Ø¹ ÙØ±Ù‚Ø§Ù‹</p>
                </div>
            </div>
            <button class="icon-btn" id="themeToggle">ğŸŒ™</button>
        </div>
    </div>

    <div class="container">
        <div id="casesGrid"></div>
        <div id="emptyState" style="display:none;text-align:center;padding:40px">
            <div style="font-size:48px;margin-bottom:15px">ğŸ“‹</div>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
        </div>
    </div>

    <div class="sync-indicator" id="syncIndicator">
        <span id="syncIcon">âœ“</span>
        <span id="syncText">Ù…ØªØ²Ø§Ù…Ù†</span>
    </div>

    <div class="modal" id="donationModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeDonationModal()">Ã—</button>
            <h2 class="modal-title">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ¨Ø±Ø¹</h2>
            <div id="donationContent"></div>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <div class="admin-header">
                <h2 style="color:var(--primary);font-family:'Cairo',sans-serif;font-size:18px">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                <button class="btn btn-danger btn-small" onclick="closeAdminPanel()">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
            
            <div style="background:linear-gradient(135deg,#2D5A27,#5B8E7D);color:white;padding:15px;border-radius:10px;margin-bottom:20px;font-size:12px">
                <div style="font-weight:700;margin-bottom:5px;font-size:14px">â˜ï¸ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø©</div>
                <div style="opacity:0.95">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙˆØªØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchTab('init')">Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</button>
                <button class="admin-tab" onclick="switchTab('cases')">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</button>
                <button class="admin-tab" onclick="switchTab('bank')">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</button>
                <button class="admin-tab" onclick="switchTab('settings')">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
            <div id="initTab" class="tab-content active">
                <div id="initForm" style="display:none;margin-bottom:20px;padding:15px;background:var(--bg);border-radius:12px">
                    <h3 style="margin-bottom:15px">Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø¯Ø±Ø©</h3>
                    <form onsubmit="saveInitiative(event)">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø© *</label>
                            <input type="text" class="form-input" id="initName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØµÙ *</label>
                            <textarea class="form-textarea" id="initDesc" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù„ÙˆÙ†</label>
                            <select class="form-input" id="initColor">
                                <option value="#2D5A27">Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚</option>
                                <option value="#5B8E7D">Ø£Ø®Ø¶Ø± Ù…Ø²Ø±Ù‚</option>
                                <option value="#689F38">Ø£Ø®Ø¶Ø± ÙØ§ØªØ­</option>
                                <option value="#6B7280">Ø±Ù…Ø§Ø¯ÙŠ</option>
                                <option value="#BC4749">Ø£Ø­Ù…Ø±</option>
                                <option value="#1F2937">Ø£Ø³ÙˆØ¯</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸</button>
                    </form>
                </div>
                <div id="caseForm" style="display:none;margin-bottom:20px;padding:15px;background:var(--bg);border-radius:12px">
                    <h3 style="margin-bottom:15px" id="caseFormTitle">Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø©</h3>
                    <form onsubmit="saveCase(event)">
                        <div class="form-group">
                            <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø© *</label>
                            <input type="text" class="form-input" id="caseTitle" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØµÙ *</label>
                            <textarea class="form-textarea" id="caseDesc" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ *</label>
                            <input type="number" class="form-input" id="caseTarget" required min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</label>
                            <input type="number" class="form-input" id="caseCollected" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <select class="form-input" id="caseStatus">
                                <option value="active">Ù†Ø´Ø·Ø©</option>
                                <option value="urgent">Ø¹Ø§Ø¬Ù„Ø©</option>
                                <option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØµÙˆØ± Ø§Ù„Ø­Ø§Ù„Ø© *</label>
                            <div class="file-upload" onclick="document.getElementById('caseImages').click()">
                                <input type="file" class="file-input" id="caseImages" multiple accept="image/*">
                                <p style="font-size:13px">ğŸ“· Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±</p>
                            </div>
                            <div class="preview-images" id="previewImages"></div>
                        </div>
                        <input type="hidden" id="caseInitId">
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸</button>
                    </form>
                </div>
                <button class="btn btn-primary" onclick="showInitForm()" style="margin-bottom:15px">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø¯Ø±Ø©</button>
                <div id="initList"></div>
            </div>
            <div id="casesTab" class="tab-content">
                <h3 style="margin-bottom:15px;font-size:16px;color:var(--primary)">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</h3>
                <div id="allCasesList"></div>
            </div>
            <div id="bankTab" class="tab-content">
                <div id="bankForm" style="display:none;margin-bottom:20px;padding:15px;background:var(--bg);border-radius:12px">
                    <h3 style="margin-bottom:15px">Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙŠ</h3>
                    <form onsubmit="saveBank(event)">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ *</label>
                            <input type="text" class="form-input" id="bankName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ *</label>
                            <input type="text" class="form-input" id="bankAccount" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨ *</label>
                            <input type="text" class="form-input" id="bankOwner" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">IBAN (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" class="form-input" id="bankIban">
                        </div>
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸</button>
                    </form>
                </div>
                <button class="btn btn-primary" onclick="showBankForm()" style="margin-bottom:15px">â• Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨</button>
                <div class="bank-accounts" id="bankList"></div>
            </div>
            <div id="settingsTab" class="tab-content">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                    <select class="form-input" id="currency">
                        <option value="SDG">Ø¬Ù†ÙŠÙ‡ Ø³ÙˆØ¯Ø§Ù†ÙŠ (Ø¬.Ø³)</option>
                        <option value="USD">Ø¯ÙˆÙ„Ø§Ø± ($)</option>
                        <option value="SAR">Ø±ÙŠØ§Ù„ (Ø±.Ø³)</option>
                        <option value="AED">Ø¯Ø±Ù‡Ù… (Ø¯.Ø¥)</option>
                        <option value="EGP">Ø¬Ù†ÙŠÙ‡ (Ø¬.Ù…)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" class="form-input" id="adminPass">
                </div>
                <button class="btn btn-primary" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                <hr style="margin:20px 0">
                <h4 style="color:var(--primary);margin-bottom:12px;font-size:15px">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h4>
                <p style="font-size:12px;color:var(--text-light);margin-bottom:12px">
                    Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø£Ù…Ø§Ù†.
                </p>
                <div style="display:flex;gap:8px;margin-bottom:15px;flex-wrap:wrap">
                    <button class="btn btn-primary" onclick="exportData()" style="flex:1">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button class="btn btn-primary" onclick="importData()" style="flex:1;background:var(--secondary)">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
                <input type="file" id="importFile" accept=".json" style="display:none">
                <hr style="margin:20px 0">
                <button class="btn btn-danger" onclick="clearAll()">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Worker API - Ø¶Ø¹ Ø±Ø§Ø¨Ø· Worker Ù‡Ù†Ø§
        const WORKER_API_URL = 'https://qatarat-api.darkleaf354.workers.dev';
        
        let tg=window.Telegram?.WebApp;
        if(tg){tg.ready();tg.expand()}
        
        let data={initiatives:[],cases:[],banks:[],password:'admin123',currency:'SDG',theme:'light'};
        let editInitIdx=null,editCaseIdx=null,tempImages=[];
        let isSyncing = false;
        
        const currencies={'SDG':'Ø¬.Ø³','USD':'$','SAR':'Ø±.Ø³','AED':'Ø¯.Ø¥','EGP':'Ø¬.Ù…'};
        
        // Sync Status Indicator
        function updateSyncStatus(status) {
            const indicator = document.getElementById('syncIndicator');
            if (!indicator) return;
            
            const icon = document.getElementById('syncIcon');
            const text = document.getElementById('syncText');
            
            indicator.classList.remove('show');
            
            const adminPanel = document.getElementById('adminPanel');
            const isAdminOpen = adminPanel && adminPanel.classList.contains('active');
            
            if (status === 'syncing') {
                indicator.style.background = 'var(--primary)';
                icon.textContent = 'â†»';
                text.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
                if (isAdminOpen) {
                    indicator.classList.add('show');
                }
            } else if (status === 'synced') {
                indicator.style.background = 'var(--success)';
                icon.textContent = 'âœ“';
                text.textContent = 'Ù…ØªØ²Ø§Ù…Ù†';
                if (isAdminOpen) {
                    indicator.classList.add('show');
                    setTimeout(() => {
                        indicator.classList.remove('show');
                    }, 2000);
                }
            } else if (status === 'error') {
                indicator.style.background = 'var(--danger)';
                icon.textContent = 'âœ—';
                text.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©';
                if (isAdminOpen) {
                    indicator.classList.add('show');
                }
            }
        }
        
        // Load data from Worker API
        async function loadFromWorker() {
            if (!WORKER_API_URL || WORKER_API_URL.includes('your-worker')) {
                console.warn('Worker URL not configured');
                const stored = localStorage.getItem('qataratData');
                if (stored) {
                    data = { ...data, ...JSON.parse(stored) };
                    renderCases();
                }
                return;
            }
            
            updateSyncStatus('syncing');
            
            try {
                const response = await fetch(`${WORKER_API_URL}/data`);
                if (!response.ok) throw new Error('Failed to fetch data');
                
                const workerData = await response.json();
                if (workerData && Object.keys(workerData).length > 0) {
                    data = { ...data, ...workerData };
                    renderCases();
                    renderInits();
                    renderAllCases();
                    renderBanks();
                    applyTheme();
                    
                    if (document.getElementById('currency')) {
                        document.getElementById('currency').value = data.currency || 'SDG';
                    }
                }
                updateSyncStatus('synced');
            } catch (error) {
                console.error('Worker load error:', error);
                updateSyncStatus('error');
                
                const stored = localStorage.getItem('qataratData');
                if (stored) {
                    data = { ...data, ...JSON.parse(stored) };
                    renderCases();
                }
            }
        }
        
        // Save data to Worker API
        async function saveToWorker() {
            try {
                localStorage.setItem('qataratData', JSON.stringify(data));
            } catch (e) {
                console.error('localStorage save error:', e);
            }
            
            if (!WORKER_API_URL || WORKER_API_URL.includes('your-worker')) {
                console.warn('Worker URL not configured, data saved locally only');
                return true;
            }
            
            isSyncing = true;
            updateSyncStatus('syncing');
            
            try {
                const response = await fetch(`${WORKER_API_URL}/data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) throw new Error('Failed to save data');
                
                updateSyncStatus('synced');
                isSyncing = false;
                return true;
            } catch (error) {
                console.error('Worker save error:', error);
                updateSyncStatus('error');
                isSyncing = false;
                return false;
            }
        }
        
        // Send Telegram notification
        async function sendTelegramNotification(message, image = null) {
            if (!WORKER_API_URL || WORKER_API_URL.includes('your-worker')) return;
            
            try {
                await fetch(`${WORKER_API_URL}/notify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message, image })
                });
            } catch (error) {
                console.error('Telegram notification error:', error);
            }
        }
        
        function fmt(n){
            return new Intl.NumberFormat('ar-SD').format(n)+' '+currencies[data.currency];
        }
        
        function applyTheme(){
            if(data.theme==='dark'){
                document.documentElement.setAttribute('data-theme','dark');
                document.getElementById('themeToggle').textContent='â˜€ï¸';
            }else{
                document.documentElement.removeAttribute('data-theme');
                document.getElementById('themeToggle').textContent='ğŸŒ™';
            }
        }
        
        function toggleTheme(){
            data.theme=data.theme==='light'?'dark':'light';
            saveToWorker();
            applyTheme();
        }
        
        function renderCases(){
            const grid=document.getElementById('casesGrid');
            const empty=document.getElementById('emptyState');
            
            if(!data.cases || data.cases.length===0){
                grid.innerHTML='';
                empty.style.display='block';
                return;
            }
            
            empty.style.display='none';
            const byInit={};
            data.cases.forEach((c,i)=>{
                const id=c.initId!==undefined?c.initId:'none';
                if(!byInit[id])byInit[id]=[];
                byInit[id].push({...c,idx:i});
            });
            
            let html='';
            Object.keys(byInit).forEach(id=>{
                const init=id==='none'?null:data.initiatives[id];
                const cases=byInit[id];
                
                if(init){
                    html+=`<div style="margin-bottom:30px;background:linear-gradient(135deg,${init.color}15,${init.color}08);border-radius:16px;overflow:hidden">
                        <div class="initiative-header" style="background:${init.color}">
                            <div>
                                <div class="initiative-title">${init.name}</div>
                                <div class="initiative-desc">${init.desc}</div>
                            </div>
                        </div>
                        <div style="padding:15px">`;
                }else{
                    html+=`<div style="margin-bottom:30px">`;
                }
                
                cases.forEach(c=>{
                    const pct=Math.min((c.collected/c.target)*100,100);
                    const rem=Math.max(c.target-c.collected,0);
                    const status={'active':'Ù†Ø´Ø·Ø©','urgent':'Ø¹Ø§Ø¬Ù„Ø©','completed':'Ù…ÙƒØªÙ…Ù„Ø©'}[c.status];
                    const color={'active':'#5B8E7D','urgent':'#BC4749','completed':'#2D5A27'}[c.status];
                    
                    html+=`<div class="case-card" data-id="${c.idx}">
                        <div class="case-images">
                            ${c.images.map((img,i)=>`<img src="${img}" class="case-image ${i===0?'active':''}" alt="${c.title}">`).join('')}
                            ${c.images.length>1?`
                                <button class="image-nav prev" onclick="navImg(${c.idx},-1)">â—€</button>
                                <button class="image-nav next" onclick="navImg(${c.idx},1)">â–¶</button>
                                <div class="indicators">${c.images.map((v,i)=>`<div class="indicator ${i===0?'active':''}" onclick="showImg(${c.idx},${i})"></div>`).join('')}</div>
                            `:''}
                        </div>
                        <div class="case-content">
                            <span class="case-status" style="color:${color}">${status}</span>
                            <h3 class="case-title">${c.title}</h3>
                            <p class="case-description">${c.desc}</p>
                            <div class="progress-info">
                                <span class="collected">Ù…Ø¬Ù…ÙˆØ¹: ${fmt(c.collected)}</span>
                                <span class="remaining">Ù…ØªØ¨Ù‚ÙŠ: ${fmt(rem)}</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width:${pct}%;${init?`background:linear-gradient(90deg, ${init.color}, ${init.color}dd)`:''}">${Math.round(pct)}%</div>
                            </div>
                            <div style="margin-top:8px;font-size:12px;color:var(--text-light)">Ø§Ù„Ù‡Ø¯Ù: ${fmt(c.target)}</div>
                            <button class="btn btn-primary" onclick="donate(${c.idx})" style="margin-top:12px;${init?`background:linear-gradient(135deg, ${init.color}, ${init.color}dd)`:''}" >â¤ï¸ ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù†</button>
                        </div>
                    </div>`;
                });
                
                html+=`</div></div>`;
            });
            
            grid.innerHTML=html;
        }
        
        let imgIdx={};
        function navImg(id,dir){
            const card=document.querySelector(`[data-id="${id}"]`);
            const imgs=card.querySelectorAll('.case-image');
            const inds=card.querySelectorAll('.indicator');
            if(!imgIdx[id])imgIdx[id]=0;
            imgs[imgIdx[id]].classList.remove('active');
            inds[imgIdx[id]].classList.remove('active');
            imgIdx[id]=(imgIdx[id]+dir+imgs.length)%imgs.length;
            imgs[imgIdx[id]].classList.add('active');
            inds[imgIdx[id]].classList.add('active');
        }
        
        function showImg(id,i){
            const card=document.querySelector(`[data-id="${id}"]`);
            const imgs=card.querySelectorAll('.case-image');
            const inds=card.querySelectorAll('.indicator');
            imgs.forEach(img=>img.classList.remove('active'));
            inds.forEach(ind=>ind.classList.remove('active'));
            imgs[i].classList.add('active');
            inds[i].classList.add('active');
            imgIdx[id]=i;
        }
        
        function donate(id){
            const c=data.cases[id];
            const banks=data.banks&&data.banks.length>0?data.banks.map(b=>`
                <div class="bank-account">
                    <div class="bank-info-item"><span class="bank-info-label">Ø§Ù„Ø¨Ù†Ùƒ:</span><span class="bank-info-value">${b.name}</span></div>
                    <div class="bank-info-item"><span class="bank-info-label">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</span><span class="bank-info-value">${b.account}</span></div>
                    <div class="bank-info-item"><span class="bank-info-label">ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨:</span><span class="bank-info-value">${b.owner}</span></div>
                    ${b.iban?`<div class="bank-info-item"><span class="bank-info-label">IBAN:</span><span class="bank-info-value">${b.iban}</span></div>`:''}
                </div>
            `).join(''):'<p style="text-align:center;font-size:13px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ù†ÙƒÙŠØ©</p>';
            
            document.getElementById('donationContent').innerHTML=`
                <div style="margin-bottom:15px;padding:12px;background:var(--accent);border-radius:10px">
                    <h3 style="font-size:15px;margin-bottom:8px">${c.title}</h3>
                    <p style="font-size:12px">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <strong style="color:var(--danger)">${fmt(c.target-c.collected)}</strong></p>
                </div>
                <h4 style="margin-bottom:12px;font-size:14px">Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©:</h4>
                ${banks}
                <div style="margin-top:20px;padding-top:15px;border-top:2px solid var(--accent)">
                    <form onsubmit="confirmDonate(event,${id})">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" class="form-input" id="donorName">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº *</label>
                            <input type="number" class="form-input" id="donateAmount" required min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <div class="file-upload" onclick="document.getElementById('receipt').click()">
                                <input type="file" class="file-input" id="receipt" accept="image/*">
                                <p style="font-size:13px">ğŸ“· Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„</p>
                            </div>
                            <div class="preview-images" id="receiptPrev"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">âœ… ØªØ£ÙƒÙŠØ¯</button>
                    </form>
                </div>
            `;
            
            document.getElementById('donationModal').classList.add('active');
            
            document.getElementById('receipt').addEventListener('change',e=>{
                const file=e.target.files[0];
                if(file){
                    compress(file,base64=>{
                        document.getElementById('receiptPrev').innerHTML=`<div class="preview-image"><img src="${base64}"></div>`;
                    });
                }
            });
        }
        
        function closeDonationModal(){
            document.getElementById('donationModal').classList.remove('active');
        }
        
        async function confirmDonate(e,id){
            e.preventDefault();
            const amt=parseFloat(document.getElementById('donateAmount').value);
            const name=document.getElementById('donorName').value.trim()||'Ù…ØªØ¨Ø±Ø¹ ÙƒØ±ÙŠÙ…';
            
            if(amt<=0){
                notify('Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­',1);
                return;
            }
            
            const img=document.querySelector('#receiptPrev img');
            const receipt=img?img.src:null;
            
            if(!data.cases[id].donations)data.cases[id].donations=[];
            data.cases[id].donations.push({amount:amt,name:name,date:new Date().toISOString()});
            data.cases[id].collected+=amt;
            
            if(data.cases[id].collected>=data.cases[id].target){
                data.cases[id].status='completed';
            }
            
            await saveToWorker();
            renderCases();
            
            const message = `ğŸ‰ <b>ØªØ¨Ø±Ø¹ Ø¬Ø¯ÙŠØ¯!</b>\n\nğŸ‘¤ ${name}\nğŸ’° ${fmt(amt)}\nğŸ“‹ ${data.cases[id].title}\nğŸ“… ${new Date().toLocaleString('ar-EG')}`;
            await sendTelegramNotification(message, receipt);
            
            closeDonationModal();
            notify(`Ø´ÙƒØ±Ø§Ù‹ ${name}! ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ğŸ’š`);
        }
        
        function compress(file,cb){
            const r=new FileReader();
            r.onload=e=>{
                const img=new Image();
                img.onload=()=>{
                    const canvas=document.createElement('canvas');
                    let w=img.width,h=img.height;
                    const max=600;
                    if(w>h){
                        if(w>max){h*=max/w;w=max}
                    }else{
                        if(h>max){w*=max/h;h=max}
                    }
                    canvas.width=w;
                    canvas.height=h;
                    const ctx=canvas.getContext('2d');
                    ctx.fillStyle='white';
                    ctx.fillRect(0,0,w,h);
                    ctx.drawImage(img,0,0,w,h);
                    cb(canvas.toDataURL('image/jpeg',0.5));
                };
                img.src=e.target.result;
            };
            r.readAsDataURL(file);
        }
        
        let tap=0,timer;
        document.addEventListener('DOMContentLoaded',()=>{
            document.querySelector('.logo').addEventListener('click',()=>{
                tap++;
                clearTimeout(timer);
                timer=setTimeout(()=>tap=0,800);
                if(tap===5){
                    adminLogin();
                    tap=0;
                }
            });
            
            document.getElementById('importFile').addEventListener('change',e=>{
                const file=e.target.files[0];
                if(!file)return;
                
                const reader=new FileReader();
                reader.onload=e=>{
                    try{
                        const imported=JSON.parse(e.target.result);
                        if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©ØŸ')){
                            data=imported;
                            saveToWorker();
                            renderInits();
                            renderAllCases();
                            renderCases();
                            renderBanks();
                            notify('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                        }
                    }catch(err){
                        notify('Ø®Ø·Ø£: Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­',1);
                    }
                };
                reader.readAsText(file);
                e.target.value='';
            });
        });
        
        function adminLogin(){
            const p=prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
            if(p===data.password){
                openAdmin();
            }else if(p!==null){
                notify('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©',1);
            }
        }
        
        function openAdmin(){
            document.getElementById('adminPanel').classList.add('active');
            renderInits();
            renderAllCases();
            renderBanks();
        }
        
        function closeAdminPanel(){
            document.getElementById('adminPanel').classList.remove('active');
            document.getElementById('syncIndicator').classList.remove('show');
        }
        
        function switchTab(t){
            document.querySelectorAll('.admin-tab').forEach(x=>x.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(t+'Tab').classList.add('active');
        }
        
        function renderInits(){
            const list=document.getElementById('initList');
            if(!list)return;
            
            if(!data.initiatives || data.initiatives.length===0){
                list.innerHTML='<p style="text-align:center;padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø¯Ø±Ø§Øª</p>';
                return;
            }
            
            list.innerHTML=data.initiatives.map((init,i)=>{
                const cases=data.cases?data.cases.filter(c=>c.initId===i):[];
                return`<div style="margin-bottom:20px;padding:15px;background:var(--bg);border-radius:12px;border-right:4px solid ${init.color}">
                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px">
                        <div style="flex:1">
                            <h3 style="font-size:16px;margin-bottom:3px;color:${init.color}">${init.name}</h3>
                            <p style="font-size:12px;color:var(--text-light)">${init.desc}</p>
                            <p style="font-size:11px;margin-top:5px">ğŸ“Š ${cases.length} Ø­Ø§Ù„Ø©</p>
                        </div>
                        <div style="display:flex;gap:6px;flex-shrink:0">
                            <button class="btn btn-primary btn-small" onclick="editInit(${i})" style="background:var(--secondary)">âœï¸</button>
                            <button class="btn btn-danger btn-small" onclick="delInit(${i})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="showCaseForm(${i})" style="width:100%;margin-bottom:10px;background:${init.color}">â• Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø©</button>
                    ${cases.map(c=>{
                        const idx=data.cases.indexOf(c);
                        const pct=Math.min((c.collected/c.target)*100,100);
                        return`<div style="background:white;padding:10px;border-radius:8px;margin-bottom:8px">
                            <div style="display:flex;justify-content:space-between;margin-bottom:8px">
                                <div style="flex:1">
                                    <h4 style="font-size:14px;margin-bottom:3px">${c.title}</h4>
                                    <p style="font-size:11px;color:var(--text-light)">${fmt(c.collected)} / ${fmt(c.target)} (${Math.round(pct)}%)</p>
                                </div>
                                <button class="btn btn-danger btn-small" onclick="delCase(${idx})">ğŸ—‘ï¸</button>
                            </div>
                            <div class="progress-bar-container"><div class="progress-bar" style="width:${pct}%;background:linear-gradient(90deg, ${init.color}, ${init.color}dd)"></div></div>
                        </div>`;
                    }).join('')}
                </div>`;
            }).join('');
        }
        
        function renderAllCases(){
            const list=document.getElementById('allCasesList');
            if(!list)return;
            
            if(!data.cases || data.cases.length===0){
                list.innerHTML='<p style="text-align:center;padding:20px;color:var(--text-light)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª</p>';
                return;
            }
            
            const completed=data.cases.filter(c=>c.status==='completed');
            const urgent=data.cases.filter(c=>c.status==='urgent');
            const active=data.cases.filter(c=>c.status==='active');
            const unassigned=data.cases.filter(c=>c.initId===undefined||c.initId==='none');
            
            let html='';
            
            if(unassigned.length>0){
                html+=`<div style="margin-bottom:25px">
                    <h4 style="font-size:15px;margin-bottom:12px;color:var(--danger);display:flex;align-items:center;gap:8px">
                        <span>âš ï¸</span>
                        <span>Ø­Ø§Ù„Ø§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø§Øª (${unassigned.length})</span>
                    </h4>
                    ${unassigned.map(c=>{
                        const idx=data.cases.indexOf(c);
                        return renderCaseItem(c,idx);
                    }).join('')}
                </div>`;
            }
            
            if(urgent.length>0){
                html+=`<div style="margin-bottom:25px">
                    <h4 style="font-size:15px;margin-bottom:12px;color:#BC4749;display:flex;align-items:center;gap:8px">
                        <span>ğŸ”´</span>
                        <span>Ø­Ø§Ù„Ø§Øª Ø¹Ø§Ø¬Ù„Ø© (${urgent.length})</span>
                    </h4>
                    ${urgent.map(c=>{
                        const idx=data.cases.indexOf(c);
                        return renderCaseItem(c,idx);
                    }).join('')}
                </div>`;
            }
            
            if(active.length>0){
                html+=`<div style="margin-bottom:25px">
                    <h4 style="font-size:15px;margin-bottom:12px;color:#5B8E7D;display:flex;align-items:center;gap:8px">
                        <span>ğŸŸ¢</span>
                        <span>Ø­Ø§Ù„Ø§Øª Ù†Ø´Ø·Ø© (${active.length})</span>
                    </h4>
                    ${active.map(c=>{
                        const idx=data.cases.indexOf(c);
                        return renderCaseItem(c,idx);
                    }).join('')}
                </div>`;
            }
            
            if(completed.length>0){
                html+=`<div style="margin-bottom:25px">
                    <h4 style="font-size:15px;margin-bottom:12px;color:#2D5A27;display:flex;align-items:center;gap:8px">
                        <span>âœ…</span>
                        <span>Ø­Ø§Ù„Ø§Øª Ù…ÙƒØªÙ…Ù„Ø© (${completed.length})</span>
                    </h4>
                    ${completed.map(c=>{
                        const idx=data.cases.indexOf(c);
                        return renderCaseItem(c,idx);
                    }).join('')}
                </div>`;
            }
            
            list.innerHTML=html;
        }
        
        function renderCaseItem(c,idx){
            const pct=Math.min((c.collected/c.target)*100,100);
            const init=c.initId!==undefined&&data.initiatives&&data.initiatives[c.initId]?data.initiatives[c.initId]:null;
            const statusColors={'active':'#5B8E7D','urgent':'#BC4749','completed':'#2D5A27'};
            const statusNames={'active':'Ù†Ø´Ø·Ø©','urgent':'Ø¹Ø§Ø¬Ù„Ø©','completed':'Ù…ÙƒØªÙ…Ù„Ø©'};
            
            return`<div style="background:var(--bg);padding:12px;border-radius:10px;margin-bottom:10px;border-right:3px solid ${statusColors[c.status]}">
                <div style="display:flex;justify-content:space-between;align-items:start;gap:10px;margin-bottom:8px">
                    <div style="flex:1;min-width:0">
                        <div style="display:flex;align-items:center;gap:6px;margin-bottom:5px;flex-wrap:wrap">
                            <h4 style="font-size:14px;margin:0">${c.title}</h4>
                        </div>
                        <p style="font-size:11px;color:var(--text-light);margin:0 0 5px 0;line-height:1.4">${c.desc.substring(0,80)}${c.desc.length>80?'...':''}</p>
                        <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:11px">
                            <span style="color:${statusColors[c.status]};font-weight:600">âš¡ ${statusNames[c.status]}</span>
                            ${init?`<span style="color:${init.color};font-weight:600">ğŸ“‚ ${init.name}</span>`:'<span style="color:var(--danger)">ğŸ“‚ Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ø§Ø¯Ø±Ø©</span>'}
                        </div>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="delCaseConfirm(${idx})" style="flex-shrink:0">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </div>
                <div style="margin-bottom:5px">
                    <div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:5px">
                        <span style="color:var(--success);font-weight:600">${fmt(c.collected)}</span>
                        <span style="color:var(--text-light)">${fmt(c.target)}</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width:${pct}%;${init?`background:linear-gradient(90deg, ${init.color}, ${init.color}dd)`:''}">${Math.round(pct)}%</div>
                    </div>
                </div>
                ${c.donations&&c.donations.length>0?`<div style="font-size:11px;color:var(--text-light);margin-top:8px">ğŸ’š Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ†: ${c.donations.length}</div>`:''}
            </div>`;
        }
        
        function delCaseConfirm(idx){
            const c=data.cases[idx];
            const msg=`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø­Ø§Ù„Ø© "${c.title}"ØŸ\n\n${c.donations&&c.donations.length>0?`âš ï¸ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${c.donations.length} Ù…ØªØ¨Ø±Ø¹`:''}`;
            if(confirm(msg)){
                delCase(idx);
            }
        }
        
        function showInitForm(){
            document.getElementById('initForm').style.display='block';
            document.getElementById('initName').value='';
            document.getElementById('initDesc').value='';
            document.getElementById('initColor').value='#2D5A27';
            editInitIdx=null;
        }
        
        function editInit(i){
            const init=data.initiatives[i];
            editInitIdx=i;
            document.getElementById('initForm').style.display='block';
            document.getElementById('initName').value=init.name;
            document.getElementById('initDesc').value=init.desc;
            document.getElementById('initColor').value=init.color;
            document.getElementById('initForm').scrollIntoView({behavior:'smooth'});
        }
        
        async function saveInitiative(e){
            e.preventDefault();
            const init={
                name:document.getElementById('initName').value,
                desc:document.getElementById('initDesc').value,
                color:document.getElementById('initColor').value
            };
            
            if(editInitIdx!==null){
                data.initiatives[editInitIdx]=init;
            }else{
                if(!data.initiatives) data.initiatives = [];
                data.initiatives.push(init);
            }
            
            await saveToWorker();
            document.getElementById('initForm').style.display='none';
            renderInits();
            renderCases();
            notify('ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }
        
        async function delInit(i){
            if(!confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©ØŸ'))return;
            data.initiatives.splice(i,1);
            if(data.cases){
                data.cases.forEach(c=>{if(c.initId>i)c.initId--});
            }
            await saveToWorker();
            renderInits();
            renderCases();
            notify('ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }
        
        function showCaseForm(initId){
            document.getElementById('caseForm').style.display='block';
            document.getElementById('caseInitId').value=initId;
            document.getElementById('caseTitle').value='';
            document.getElementById('caseDesc').value='';
            document.getElementById('caseTarget').value='';
            document.getElementById('caseCollected').value='0';
            document.getElementById('previewImages').innerHTML='';
            tempImages=[];
            editCaseIdx=null;
            
            document.getElementById('caseImages').addEventListener('change',e=>{
                Array.from(e.target.files).forEach(f=>{
                    if(f.type.startsWith('image/')){
                        compress(f,b64=>{
                            tempImages.push(b64);
                            renderPreviews();
                        });
                    }
                });
            });
        }
        
        function renderPreviews(){
            document.getElementById('previewImages').innerHTML=tempImages.map((img,i)=>
                `<div class="preview-image">
                    <img src="${img}">
                    <button class="preview-remove" onclick="tempImages.splice(${i},1);renderPreviews()">Ã—</button>
                </div>`
            ).join('');
        }
        
        async function saveCase(e){
            e.preventDefault();
            
            if(tempImages.length===0){
                notify('Ø£Ø¶Ù ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',1);
                return;
            }
            
            const c={
                initId:parseInt(document.getElementById('caseInitId').value),
                title:document.getElementById('caseTitle').value,
                desc:document.getElementById('caseDesc').value,
                target:parseFloat(document.getElementById('caseTarget').value),
                collected:parseFloat(document.getElementById('caseCollected').value)||0,
                status:document.getElementById('caseStatus').value,
                images:[...tempImages]
            };
            
            if(editCaseIdx!==null){
                data.cases[editCaseIdx]=c;
            }else{
                if(!data.cases) data.cases = [];
                data.cases.push(c);
            }
            
            await saveToWorker();
            document.getElementById('caseForm').style.display='none';
            renderInits();
            renderAllCases();
            renderCases();
            notify('ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }
        
        async function delCase(i){
            data.cases.splice(i,1);
            await saveToWorker();
            renderInits();
            renderAllCases();
            renderCases();
            notify('ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }
        
        function renderBanks(){
            const list=document.getElementById('bankList');
            if(!list)return;
            
            if(!data.banks || data.banks.length===0){
                list.innerHTML='<p style="text-align:center;padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª</p>';
                return;
            }
            
            list.innerHTML=data.banks.map((b,i)=>`
                <div class="bank-account">
                    <div class="bank-info-item"><span class="bank-info-label">Ø§Ù„Ø¨Ù†Ùƒ:</span><span class="bank-info-value">${b.name}</span></div>
                    <div class="bank-info-item"><span class="bank-info-label">Ø§Ù„Ø­Ø³Ø§Ø¨:</span><span class="bank-info-value">${b.account}</span></div>
                    <div class="bank-info-item"><span class="bank-info-label">Ø§Ù„Ø§Ø³Ù…:</span><span class="bank-info-value">${b.owner}</span></div>
                    ${b.iban?`<div class="bank-info-item"><span class="bank-info-label">IBAN:</span><span class="bank-info-value">${b.iban}</span></div>`:''}
                    <button class="btn btn-danger btn-small" onclick="delBank(${i})" style="margin-top:10px">Ø­Ø°Ù</button>
                </div>
            `).join('');
        }
        
        function showBankForm(){
            document.getElementById('bankForm').style.display='block';
            document.getElementById('bankName').value='';
            document.getElementById('bankAccount').value='';
            document.getElementById('bankOwner').value='';
            document.getElementById('bankIban').value='';
        }
        
        async function saveBank(e){
            e.preventDefault();
            if(!data.banks) data.banks = [];
            data.banks.push({
                name:document.getElementById('bankName').value,
                account:document.getElementById('bankAccount').value,
                owner:document.getElementById('bankOwner').value,
                iban:document.getElementById('bankIban').value
            });
            await saveToWorker();
            document.getElementById('bankForm').style.display='none';
            renderBanks();
            notify('ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }
        
        async function delBank(i){
            if(!confirm('Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ'))return;
            data.banks.splice(i,1);
            await saveToWorker();
            renderBanks();
            notify('ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }
        
        async function saveSettings(){
            const p=document.getElementById('adminPass').value;
            const c=document.getElementById('currency').value;
            
            if(p&&p.length>=4)data.password=p;
            if(c)data.currency=c;
            
            await saveToWorker();
            renderCases();
            notify('ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }
        
        async function clearAll(){
            if(!confirm('Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ØŸ'))return;
            if(!confirm('ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠØŸ'))return;
            data={initiatives:[],cases:[],banks:[],password:'admin123',currency:'SDG',theme:'light'};
            await saveToWorker();
            renderInits();
            renderCases();
            renderBanks();
            closeAdminPanel();
            notify('ØªÙ… Ø§Ù„Ø­Ø°Ù');
        }
        
        function exportData(){
            try{
                const dataStr=JSON.stringify(data,null,2);
                const blob=new Blob([dataStr],{type:'application/json'});
                const url=URL.createObjectURL(blob);
                const a=document.createElement('a');
                a.href=url;
                a.download=`qatarat_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                notify('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…');
            }catch(e){
                notify('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±',1);
            }
        }
        
        function importData(){
            document.getElementById('importFile').click();
        }
        
        function notify(msg,err=0){
            const n=document.getElementById('notification');
            n.textContent=msg;
            n.className='notification'+(err?' error':'');
            n.classList.add('show');
            setTimeout(()=>n.classList.remove('show'),3000);
        }
        
        document.getElementById('themeToggle').addEventListener('click',toggleTheme);
        
        // Initialize app
        loadFromWorker();
        renderCases();
    </script>
</body>
</html>
